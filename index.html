<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Northern Nigeria MPI — Standalone Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body{margin:0;background:#0b1220;color:#dbe7f3;font-family:system-ui,Segoe UI,Roboto,Arial}
    .wrap{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px}
    .card{background:#0f172a;border:1px solid #1f2a44;border-radius:12px;padding:12px}
    .title{color:#9fb2c7;margin:0 0 8px 0;font-size:16px}
    #map{height:560px;border-radius:10px}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    select{background:#0b1220;color:#e5edf7;border:1px solid #243556;border-radius:8px;padding:6px 8px}
    .row{display:flex;gap:12px}.col{flex:1}.chart{height:260px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="col">
      <div class="card">
        <h3 class="title">Map Controls</h3>
        <div class="controls">
          <label>Metric
            <select id="metric">
              <option>Average of Multidimensionally_Poor</option>
              <option>Income</option>
              <option>Employment</option>
              <option>Health</option>
              <option>Education</option>
              <option>Standard_of_Living</option>
              <option>Security</option>
            </select>
          </label>
          <label>Region
            <select id="region">
              <option>All</option>
              <option>North East</option>
              <option>North West</option>
              <option>North Central</option>
            </select>
          </label>
          <label>State
            <select id="stateSel"></select>
          </label>
        </div>
      </div>
      <div class="card">
        <h3 class="title">Northern Nigeria — Value-based Choropleth</h3>
        <div id="map"></div>
      </div>
    </div>
    <div class="col">
      <div class="card">
        <h3 class="title" id="barTitle">All States — Average of Multidimensionally_Poor</h3>
        <div id="barStates" class="chart"></div>
      </div>
      <div class="card">
        <h3 class="title" id="barRegionTitle">Regional Averages — Average of Multidimensionally_Poor</h3>
        <div id="barRegions" class="chart"></div>
      </div>
      <div class="card">
        <div class="row"><div class="col"><h3 class="title">State Indicators</h3></div></div>
        <div id="barStateProfile" class="chart" style="height:240px;"></div>
      </div>
      <div class="card">
        <h3 class="title">Indicator Multi-line Comparison</h3>
        <div id="lineMulti" class="chart"></div>
      </div>
    </div>
  </div>

  <!-- libs -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.29.1.min.js"></script>

  <script>
  // ------------------ DATA (from your Excel snippet) ------------------
  const NORTH19 = ["Adamawa","Bauchi","Borno","Gombe","Taraba","Yobe",
                   "Jigawa","Kaduna","Kano","Katsina","Kebbi","Sokoto","Zamfara",
                   "Benue","Kogi","Kwara","Nasarawa","Niger","Plateau"];

  const REGION_MAP = {
    Adamawa:"North East", Bauchi:"North East", Borno:"North East", Gombe:"North East", Taraba:"North East", Yobe:"North East",
    Jigawa:"North West", Kaduna:"North West", Kano:"North West", Katsina:"North West", Kebbi:"North West", Sokoto:"North West", Zamfara:"North West",
    Benue:"North Central", Kogi:"North Central", Kwara:"North Central", Nasarawa:"North Central", Niger:"North Central", Plateau:"North Central"
  };

  // Average of Multidimensionally_Poor (%), converted from proportions
  const MPI_PCT = {
    Adamawa:98.72, Bauchi:96.53, Benue:98.57, Borno:98.45, Gombe:93.82, Jigawa:94.57,
    Kaduna:94.96, Kano:91.83, Katsina:96.59, Kebbi:86.05, Kogi:94.10, Kwara:93.08,
    Nasarawa:94.03, Niger:91.60, Plateau:97.82, Sokoto:89.11, Taraba:99.29, Yobe:97.54, Zamfara:98.08
  };

  // Indicators (Submitted One)
  const IND = {
    Adamawa:{Income:98.92,Employment:64.50,Health:60.85,Education:77.97,Standard_of_Living:99.33,Security:59.93},
    Bauchi:{Income:98.85,Employment:58.17,Health:72.62,Education:73.88,Standard_of_Living:99.65,Security:37.75},
    Benue:{Income:99.41,Employment:65.39,Health:88.56,Education:88.20,Standard_of_Living:97.20,Security:57.57},
    Borno:{Income:98.46,Employment:56.64,Health:69.54,Education:79.88,Standard_of_Living:99.90,Security:70.41},
    Gombe:{Income:99.27,Employment:42.45,Health:58.36,Education:67.03,Standard_of_Living:97.24,Security:36.09},
    Jigawa:{Income:94.33,Employment:54.73,Health:64.51,Education:62.65,Standard_of_Living:98.40,Security:52.49},
    Kaduna:{Income:96.78,Employment:61.93,Health:69.42,Education:69.43,Standard_of_Living:97.41,Security:54.10},
    Kano:{Income:95.07,Employment:54.27,Health:55.25,Education:62.53,Standard_of_Living:98.55,Security:34.35},
    Katsina:{Income:98.43,Employment:64.66,Health:67.68,Education:65.10,Standard_of_Living:99.35,Security:61.49},
    Kebbi:{Income:90.89,Employment:45.22,Health:52.70,Education:58.92,Standard_of_Living:99.16,Security:47.81},
    Kogi:{Income:98.48,Employment:61.06,Health:63.24,Education:66.65,Standard_of_Living:94.40,Security:61.90},
    Kwara:{Income:97.71,Employment:61.67,Health:56.96,Education:62.50,Standard_of_Living:89.90,Security:65.00},
    Nasarawa:{Income:98.92,Employment:70.28,Health:69.21,Education:67.56,Standard_of_Living:95.54,Security:50.87},
    Niger:{Income:94.93,Employment:49.00,Health:68.49,Education:73.76,Standard_of_Living:97.93,Security:48.67},
    Plateau:{Income:99.47,Employment:51.61,Health:51.53,Education:66.39,Standard_of_Living:96.90,Security:51.94},
    Sokoto:{Income:95.00,Employment:46.78,Health:40.89,Education:56.83,Standard_of_Living:99.07,Security:48.31},
    Taraba:{Income:93.18,Employment:66.24,Health:86.27,Education:83.84,Standard_of_Living:99.62,Security:76.76},
    Yobe:{Income:98.54,Employment:61.23,Health:64.00,Education:74.92,Standard_of_Living:99.83,Security:42.71},
    Zamfara:{Income:99.50,Employment:76.22,Health:58.31,Education:51.00,Standard_of_Living:99.39,Security:88.14}
  };

  const DATA = NORTH19.map(s => ({
    State:s,
    Region: REGION_MAP[s],
    "Average of Multidimensionally_Poor": MPI_PCT[s],
    ...IND[s]
  }));

  const byState = Object.fromEntries(DATA.map(d => [d.State, d]));
  const coreIndicators = ["Income","Employment","Health","Education","Standard_of_Living","Security"];

  // ------------------ MAP + UI ------------------
  const stateSel = document.getElementById('stateSel');
  NORTH19.slice().sort().forEach(s => {
    const opt = document.createElement('option'); opt.value = opt.textContent = s; stateSel.appendChild(opt);
  });
  const metricSel = document.getElementById('metric');
  const regionSel = document.getElementById('region');

  const map = L.map('map',{preferCanvas:true,minZoom:4});
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{opacity:0.55}).addTo(map);

  let geoLayer;
  function loadGeo() {
    return fetch('States.geojson').then(r=>r.json()).then(gj=>{
      // Filter to 19 states and ensure State prop exists
      gj.features = gj.features.filter(f=>{
        const p = f.properties||{};
        const name = (p.statename||p.NAME_1||p.ADM1_EN||p.name||"").toString().trim();
        const st = name.charAt(0).toUpperCase()+name.slice(1).toLowerCase();
        f.properties = {...p, State: st};
        return NORTH19.includes(st);
      });
      if (geoLayer) map.removeLayer(geoLayer);
      geoLayer = L.geoJSON(gj,{style:{color:'#0b1220',weight:1,fillOpacity:0.85}}).addTo(map);
      map.fitBounds(geoLayer.getBounds(),{padding:[10,10]});
      return gj;
    });
  }

  function palette(v, min, max){
    const t = (v-min)/((max-min)||1);
    const c1=[68,1,84], c2=[58,82,139], c3=[253,231,37];
    let r,g,b;
    if (t<0.5){const tt=t/0.5; r=c1[0]+(c2[0]-c1[0])*tt; g=c1[1]+(c2[1]-c1[1])*tt; b=c1[2]+(c2[2]-c1[2])*tt;}
    else {const tt=(t-0.5)/0.5; r=c2[0]+(c3[0]-c2[0])*tt; g=c2[1]+(c3[1]-c2[1])*tt; b=c2[2]+(c3[2]-c2[2])*tt;}
    return `rgb(${Math.round(r)},${Math.round(g)},${Math.round(b)})`;
  }

  function filteredData(){
    const reg = regionSel.value;
    if (reg==='All') return DATA;
    return DATA.filter(d=>d.Region===reg);
  }

  function colorizeMap(){
    const metric = metricSel.value;
    const d = filteredData();
    const vals = d.map(r=>+r[metric]).filter(x=>!isNaN(x));
    const min = Math.min(...vals), max = Math.max(...vals);

    geoLayer.eachLayer(l=>{
      const st = l.feature.properties.State;
      const row = byState[st];
      let fill = '#444';
      if (row && row[metric]!=null && !isNaN(row[metric])) fill = palette(+row[metric],min,max);
      l.setStyle({fillColor:fill});
      const tip = `<b>${st}</b><br/>Region: ${row?.Region||''}<br/>${metric}: ${row?.[metric]??'NA'}%`;
      l.bindTooltip(tip);
    });

    // compact legend
    if (map._legendCtl) map.removeControl(map._legendCtl);
    const legend = L.control({position:'bottomright'});
    legend.onAdd=function(){
      const div=L.DomUtil.create('div','info legend');
      Object.assign(div.style,{background:'rgba(15,23,42,0.8)',color:'#e5edf7',padding:'8px 10px',border:'1px solid #1f2a44',borderRadius:'8px',fontSize:'12px'});
      const steps=4, labels=[];
      for (let i=0;i<=steps;i++){
        const v = min+(max-min)*i/steps, c = palette(v,min,max);
        labels.push(`<span style="display:inline-block;width:14px;height:10px;background:${c};margin-right:6px;border-radius:2px;"></span>${v.toFixed(0)}%`);
      }
      div.innerHTML = `<div style="margin-bottom:6px;"><b>${metric} (%)</b></div>`+labels.join('<br/>');
      return div;
    };
    legend.addTo(map); map._legendCtl = legend;
  }

  function drawBars(){
    const metric = metricSel.value;
    const d = filteredData().slice().sort((a,b)=>(b[metric]??-1)-(a[metric]??-1));
    const x = d.map(r=>r.State), y = d.map(r=>r[metric]);
    Plotly.newPlot('barStates',[{type:'bar',x,y,marker:{color:'#93c5fd'},hovertemplate:'<b>%{x}</b><br>'+metric+': %{y}%<extra></extra>'}],
      {paper_bgcolor:'#0f172a',plot_bgcolor:'#0f172a',xaxis:{title:'',tickangle:-45,color:'#cdd7e4'},yaxis:{title:'%',color:'#cdd7e4'},margin:{b:90,t:10,r:10,l:50}},
      {displayModeBar:false});
    document.getElementById('barTitle').textContent=`All States — ${metric}`;
  }

  function drawRegionalBars(){
    const metric = metricSel.value, d = filteredData(), byR={};
    for (const r of d){ if(!byR[r.Region]) byR[r.Region]=[]; if(r[metric]!=null) byR[r.Region].push(+r[metric]); }
    const labels=["North East","North West","North Central"];
    const vals=labels.map(r=>{const arr=byR[r]||[]; return arr.length? +(arr.reduce((a,b)=>a+b,0)/arr.length).toFixed(1):null;});
    Plotly.newPlot('barRegions',[{type:'bar',orientation:'h',y:labels,x:vals,marker:{color:['#86efac','#fca5a5','#fde68a'],line:{color:'#1f2937',width:1}},
      hovertemplate:'<b>%{y}</b><br>'+metric+': %{x}%<extra></extra>'}],
      {paper_bgcolor:'#0f172a',plot_bgcolor:'#0f172a',xaxis:{title:'%',range:[0,100],color:'#cdd7e4'},yaxis:{title:'',color:'#cdd7e4'},margin:{l:80,r:20,t:10,b:20},bargap:0.3},
      {displayModeBar:false});
    document.getElementById('barRegionTitle').textContent=`Regional Averages — ${metric}`;
  }

  function applyRegionToStates(){
    const reg = regionSel.value;
    const list = reg==='All' ? NORTH19.slice() : DATA.filter(d=>d.Region===reg).map(d=>d.State);
    stateSel.innerHTML=''; list.sort().forEach(s=>{const o=document.createElement('option');o.value=o.textContent=s;stateSel.appendChild(o);});
  }

  function drawStateProfile(){
    const st = stateSel.value, row = byState[st];
    const labs = coreIndicators.map(k=>k==='Standard_of_Living'?'Std. Living':k.replace('_',' '));
    const vals = coreIndicators.map(k=>row[k]??null);
    Plotly.newPlot('barStateProfile',[{type:'bar',x:labs,y:vals,marker:{color:'#fbcfe8'},hovertemplate:'%{x}: %{y}%<extra></extra>'}],
      {paper_bgcolor:'#0f172a',plot_bgcolor:'#0f172a',yaxis:{title:'%',range:[0,100],color:'#cdd7e4'},xaxis:{color:'#cdd7e4'},margin:{t:10,r:10,l:50,b:50}},
      {displayModeBar:false});
  }

  function drawMultiLine(){
    const st = stateSel.value, row = byState[st];
    const labels = coreIndicators.map(k=>k==='Standard_of_Living'?'Std. Living':k.replace('_',' '));
    const traces = coreIndicators.map((k,i)=>({type:'scatter',mode:'lines+markers',x:labels,y:labels.map((_,j)=>j===i?(row[k]??null):null),
      name:labels[i],line:{width:3},marker:{size:8}}));
    Plotly.newPlot('lineMulti', traces,
      {paper_bgcolor:'#0f172a',plot_bgcolor:'#0f172a',yaxis:{title:'%',range:[0,100],color:'#cdd7e4'},xaxis:{color:'#cdd7e4'},legend:{orientation:'h',y:-0.25},margin:{t:10,r:10,l:50,b:60}},
      {displayModeBar:false});
  }

  // Events
  metricSel.addEventListener('change', ()=>{ colorizeMap(); drawBars(); drawRegionalBars(); });
  regionSel.addEventListener('change', ()=>{ applyRegionToStates(); colorizeMap(); drawBars(); drawRegionalBars(); drawStateProfile(); drawMultiLine(); });
  stateSel.addEventListener('change', ()=>{ drawStateProfile(); drawMultiLine(); });

  // Init everything
  (async function init(){
    applyRegionToStates();
    stateSel.value = stateSel.options[0]?.value || '';
    await loadGeo();
    colorizeMap(); drawBars(); drawRegionalBars(); drawStateProfile(); drawMultiLine();
  })();
  </script>
</body>
</html>
